---
import { Icon } from "astro-icon/components";
import type { Project } from "@/data/projects";

export interface Props {
  project: Project;
  ogImageUrl: string | null;
}

const { project, ogImageUrl } = Astro.props;
const { title, description, githubUrl, liveUrl, techStack, date } = project;

const formattedDate = date.toLocaleDateString("ko-KR", {
  year: "numeric",
  month: "long",
});

const primaryUrl = liveUrl ?? githubUrl;
---

<article
  class="group flex flex-col overflow-hidden rounded-lg border border-border bg-background
         transition-all duration-300
         hover:-translate-y-1 hover:border-accent/50 hover:shadow-lg"
>
  <a
    href={primaryUrl}
    target="_blank"
    rel="noopener noreferrer"
    class="block"
    aria-label={`${title} 프로젝트 바로가기`}
  >
    {
      ogImageUrl ? (
        <div class="relative aspect-video w-full overflow-hidden">
          <img
            src={ogImageUrl}
            alt={`${title} 프로젝트 미리보기`}
            class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
            loading="lazy"
          />
          {/* Gradient overlay */}
          <div class="absolute inset-0 bg-linear-to-t from-background/60 via-transparent to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100" />
        </div>
      ) : (
        <div class="flex aspect-video w-full items-center justify-center bg-accent/5 dark:bg-accent/10">
          <Icon name="ph:image" size={48} class="text-foreground/20" />
        </div>
      )
    }
  </a>
  <div class="flex flex-1 flex-col border-t border-border p-4">
    <a
      href={primaryUrl}
      target="_blank"
      rel="noopener noreferrer"
      class="group/title"
      aria-label={`${title} 프로젝트 바로가기`}
    >
      <h2 class="text-xl font-semibold text-foreground group-hover/title:text-accent group-hover/title:underline">
        {title}
      </h2>
    </a>
    <div class="mt-1 flex items-center gap-1 text-xs text-foreground/60">
      <Icon name="ph:calendar-blank" size={14} />
      <span>{formattedDate}</span>
    </div>
    <p class="mt-2 flex-1 text-sm text-foreground/80">{description}</p>

    <ul class="mt-3 flex flex-wrap gap-2">
      {
        techStack.map(tech => (
          <li class="rounded-full border border-accent/20 bg-accent/5 px-2.5 py-0.5 text-xs font-medium text-accent">
            {tech}
          </li>
        ))
      }
    </ul>

    <div class="mt-4 flex items-center justify-end border-t border-border pt-4">
      <a
        href={githubUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="group/btn flex items-center gap-1 rounded-md px-2 py-1 text-sm text-foreground/80
               transition-all duration-200
               hover:-translate-y-0.5 hover:bg-accent/10 hover:text-accent"
        aria-label={`${title} GitHub 저장소`}
      >
        <Icon
          name="ph:github-logo"
          size={18}
          class="transition-transform duration-200 group-hover/btn:rotate-12"
        />
        <span class="sr-only sm:not-sr-only">GitHub</span>
      </a>
    </div>
  </div>
</article>
