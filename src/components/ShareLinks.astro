---
import IconCopy from "@/assets/icons/IconCopy.svg";
import IconCheck from "@/assets/icons/IconCheck.svg";
---

<div class="flex flex-none flex-col items-center justify-center gap-1 md:items-start">
  <span class="italic">공유하기</span>
  <div class="text-center">
    <button
      id="copy-url-btn"
      class="group relative scale-90 rounded-md bg-transparent p-2 transition-all duration-200 hover:rotate-6 hover:bg-accent/10 sm:p-1"
      title="URL을 클립보드에 복사"
      aria-label="URL을 클립보드에 복사"
    >
      <IconCopy id="copy-icon" class="inline-block size-6 scale-125 fill-transparent stroke-current stroke-2 opacity-90 group-hover:fill-transparent sm:scale-110 transition-all duration-300" />
      <IconCheck id="check-icon" class="inline-block size-6 scale-125 fill-transparent stroke-current stroke-2 opacity-0 absolute top-2 left-2 transition-all duration-300 text-green-600 sm:top-1 sm:left-1" />
    </button>
    <div 
      id="copy-feedback" 
      class="mt-1 text-xs text-accent/70 opacity-0 transition-opacity duration-200 sr-only"
      aria-live="polite"
    >
      복사됨!
    </div>
  </div>
</div>

<script>
  const copyButton = document.getElementById('copy-url-btn');
  const feedback = document.getElementById('copy-feedback');
  const copyIcon = document.getElementById('copy-icon');
  const checkIcon = document.getElementById('check-icon');
  
  if (copyButton && feedback && copyIcon && checkIcon) {
    copyButton.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(window.location.href);
        showSuccessIcon();
      } catch {
        // 클립보드 API를 사용할 수 없는 경우 폴백 사용
        const textArea = document.createElement('textarea');
        textArea.value = window.location.href;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showSuccessIcon();
      }
    });
    
    function showSuccessIcon() {
      // 아이콘 전환
      if (copyIcon) copyIcon.style.opacity = '0';
      if (checkIcon) checkIcon.style.opacity = '1';
      
      // 접근성을 위한 텍스트 피드백
      if (feedback) feedback.style.opacity = '1';
      
      // 2초 후 원래 상태로 복원
      setTimeout(() => {
        if (copyIcon) copyIcon.style.opacity = '0.9';
        if (checkIcon) checkIcon.style.opacity = '0';
        if (feedback) feedback.style.opacity = '0';
      }, 2000);
    }
  }
</script>
